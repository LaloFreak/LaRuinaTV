{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Autor/Desktop/LaRuinaTV/api/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _toConsumableArray from\"C:/Users/Autor/Desktop/LaRuinaTV/api/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"C:/Users/Autor/Desktop/LaRuinaTV/api/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";var express=require('express');var server=express.Router();var users=require('../../users.json');var fs=require('fs');var _require=require('../../Functions/users'),findUser=_require.findUser,findUserByIp=_require.findUserByIp,findUsers=_require.findUsers;server.get('/',function(req,res){var ip=req.headers['x-forwarded-for']||req.connection.remoteAddress;var usersFound=findUsers(ip);return res.status(200).send(usersFound);});server.post('/create',/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(req,res,next){var _req$body,alias,email,contraseña,ip,userFound,newUser,usersList,usersToJson;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_req$body=req.body,alias=_req$body.alias,email=_req$body.email,contraseña=_req$body.contraseña;ip=req.headers['x-forwarded-for']||req.connection.remoteAddress;userFound=findUser(alias,email);if(!(!alias||!email||!contraseña||userFound.length>0)){_context.next=5;break;}return _context.abrupt(\"return\",res.status(404).json({error:'Error'}));case 5:_context.prev=5;newUser={\"userStatus\":[{\"ip\":[{\"id\":ip,\"onlineState\":false}]}],\"alias\":alias,\"email\":email,\"contraseña\":contraseña};usersList=[].concat(_toConsumableArray(users),[newUser]);usersToJson=JSON.stringify(usersList);fs.writeFile(\"users.json\",usersToJson,function(err){if(err)console.log(err);else{console.log(\"File written successfully\\n\");console.log(\"The written has the following contents:\");console.log(fs.readFileSync(\"users.json\",\"utf8\"));}});return _context.abrupt(\"return\",res.status(200).json(\"Usuario creado con éxito.\"));case 13:_context.prev=13;_context.t0=_context[\"catch\"](5);next(_context.t0);case 16:case\"end\":return _context.stop();}},_callee,null,[[5,13]]);}));return function(_x,_x2,_x3){return _ref.apply(this,arguments);};}());server.get('/loggedaccount',/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(req,res,next){var ip,user,log;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:ip=req.headers['x-forwarded-for']||req.connection.remoteAddress;_context2.next=3;return findUserByIp(ip);case 3:user=_context2.sent;_context2.next=6;return user;case 6:if(!_context2.sent){_context2.next=10;break;}_context2.t0=user.userStatus.at(0).ip.at(0).onlineState;_context2.next=11;break;case 10:_context2.t0=false;case 11:log=_context2.t0;res.status(200).json([user,log]);case 13:case\"end\":return _context2.stop();}},_callee2);}));return function(_x4,_x5,_x6){return _ref2.apply(this,arguments);};}());server.post('/login',function(req,res,next){var ip=req.headers['x-forwarded-for']||req.connection.remoteAddress;var _req$body$at=req.body.at(0),userName=_req$body$at.userName,contraseña=_req$body$at.contraseña;var user=findUser(userName,userName);if(user.at(0).contraseña===contraseña){users.filter(function(e){return e.alias===user.at(0).alias;}).at(0).userStatus.filter(function(e){return e.ip.find(function(e){return e.id===ip;});}).at(0).ip.at(0).onlineState=true;var usersToJson=JSON.stringify(users);fs.writeFile(\"users.json\",usersToJson,function(err){if(err)console.log(err);else{console.log(\"File written successfully\\n\");console.log(\"The written has the following contents:\");console.log(fs.readFileSync(\"users.json\",\"utf8\"));}});return res.status(200).json({state:true,current:user.at(0).alias});}});server.post('/logout',function(req,res){var userName=req.body.userName;var ip=req.headers['x-forwarded-for']||req.connection.remoteAddress;var user=findUser(userName,userName);users.filter(function(e){return e.alias===user.at(0).alias;}).at(0).userStatus.filter(function(e){return e.ip.find(function(e){return e.id===ip;});}).at(0).ip.at(0).onlineState=false;var usersToJson=JSON.stringify(users);fs.writeFile(\"users.json\",usersToJson,function(err){if(err)console.log(err);else console.log(\"Log Out\");});res.status(200).json({state:false,current:''});});module.exports=server;","map":{"version":3,"names":["express","require","server","Router","users","fs","findUser","findUserByIp","findUsers","get","req","res","ip","headers","connection","remoteAddress","usersFound","status","send","post","next","body","alias","email","contraseña","userFound","length","json","error","newUser","usersList","usersToJson","JSON","stringify","writeFile","err","console","log","readFileSync","user","userStatus","at","onlineState","userName","filter","e","find","id","state","current","module","exports"],"sources":["C:/Users/Autor/Desktop/LaRuinaTV/api/src/Routes/server/users.js"],"sourcesContent":["const express = require('express')\r\nconst server = express.Router()\r\nconst users = require('../../users.json')\r\nconst fs = require('fs');\r\nconst { findUser, findUserByIp, findUsers } = require('../../Functions/users');\r\n\r\nserver.get('/', (req,res)=>{\r\n  const ip = req.headers['x-forwarded-for'] || req.connection.remoteAddress;\r\n  const usersFound = findUsers(ip)\r\n  return res.status(200).send(usersFound)\r\n})\r\n\r\nserver.post('/create', async (req,res,next)=>{\r\n    const {alias, email, contraseña} = req.body;\r\n    const ip = req.headers['x-forwarded-for'] || req.connection.remoteAddress;\r\n    const userFound = findUser(alias, email)\r\n    if (!alias || !email || !contraseña || userFound.length>0) return res.status(404).json({error : 'Error'});\r\n    try {\r\n        const newUser = {\"userStatus\":[{\"ip\":[{\"id\":ip,\"onlineState\":false}]}],\"alias\":alias,\"email\":email,\"contraseña\":contraseña}\r\n        const usersList = [...users, newUser]\r\n        const usersToJson = JSON.stringify(usersList)\r\n\r\n        fs.writeFile(\"users.json\", usersToJson, (err) => {\r\n          if (err)\r\n            console.log(err);\r\n          else {\r\n            console.log(\"File written successfully\\n\");\r\n            console.log(\"The written has the following contents:\");\r\n            console.log(fs.readFileSync(\"users.json\", \"utf8\"));\r\n          }\r\n        });\r\n        return res.status(200).json(\"Usuario creado con éxito.\")\r\n    }catch(error){\r\n        next(error);\r\n    }\r\n})\r\n\r\nserver.get('/loggedaccount', async (req, res, next)=>{\r\n  const ip = req.headers['x-forwarded-for'] || req.connection.remoteAddress;\r\n  const user = await findUserByIp(ip)\r\n  const log = await user? user.userStatus.at(0).ip.at(0).onlineState : false\r\n  res.status(200).json([user, log])\r\n})\r\n\r\nserver.post('/login',(req,res,next)=>{\r\n  const ip = req.headers['x-forwarded-for'] || req.connection.remoteAddress;\r\n  const {userName, contraseña} = req.body.at(0);\r\n  const user = findUser(userName, userName)\r\n  if(user.at(0).contraseña === contraseña){\r\n    users.filter(e=> e.alias===user.at(0).alias).at(0).userStatus.filter(e=> e.ip.find(e=>e.id === ip)).at(0).ip.at(0).onlineState = true\r\n    const usersToJson = JSON.stringify(users)\r\n\r\n    fs.writeFile(\"users.json\", usersToJson, (err) => {\r\n        if (err)\r\n          console.log(err);\r\n        else {\r\n          console.log(\"File written successfully\\n\");\r\n          console.log(\"The written has the following contents:\");\r\n          console.log(fs.readFileSync(\"users.json\", \"utf8\"));\r\n        }\r\n      }\r\n    )\r\n    return res.status(200).json({state:true, current:user.at(0).alias})\r\n  }\r\n})\r\n\r\nserver.post('/logout', (req,res)=>{\r\n  const {userName} = req.body;\r\n  const ip = req.headers['x-forwarded-for'] || req.connection.remoteAddress;\r\n  const user = findUser(userName, userName)\r\n  users.filter(e=> e.alias===user.at(0).alias).at(0).userStatus.filter(e=> e.ip.find(e=>e.id === ip)).at(0).ip.at(0).onlineState = false\r\n  const usersToJson = JSON.stringify(users)\r\n\r\n  fs.writeFile(\"users.json\", usersToJson, (err) => {\r\n      if (err) console.log(err);\r\n      else console.log(\"Log Out\");\r\n    }\r\n  )\r\n  res.status(200).json({state:false, current:''})\r\n})\r\n\r\n\r\n\r\nmodule.exports = server"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}